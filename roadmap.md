这份文档从产品演进的角度，总结了 **LoopHunter / Smart Audio Remixer** 从初始 MVP 到当前成熟版本的迭代路线图。

# 🎵 LoopHunter 产品迭代路线图

本文档概述了智能音频重组工具（Smart Audio Remixer）的开发历程。产品演进主要经历了五个阶段，从基础的音频切片拼接，进化为基于音乐语义分析的智能重组系统。

---

## 📅 第一阶段：基础架构搭建 (MVP)
**目标**：验证“自动调整音频时长”的核心概念，建立基本的前后端框架。

* **核心功能**：
    * **基础切片引擎**：基于能量（RMS）和色度（Chroma）特征，将音频划分为 `Intro`（前奏）、`Verse`（主歌）、`Chorus`（副歌）、`Outro`（尾奏）等基础积木。
    * **随机拼接**：根据用户设定的目标时长，简单的通过随机抽取和堆叠积木来填充时间。
    * **基础 UI**：搭建了 Streamlit 界面，支持文件上传和时长滑块。
* **面临挑战**：
    * Intro 识别过于粗糙（整个前奏被当成一块，无法灵活伸缩）。
    * 片段衔接生硬，缺乏节奏对齐。
    * 生成的结构混乱，缺乏音乐性。

---

## 📅 第二阶段：节奏与结构完整性 (Rhythm & Structure)
**目标**：解决“听感割裂”和“节奏错位”问题，确保生成的音频符合 4/4 拍音乐逻辑。

* **核心迭代**：
    * **网格化处理 (Grid Quantization)**：放弃随意切片，强制将音频按 **4小节 (16拍)** 为单位进行划分，确保乐句的完整性。
    * **瞬态对齐 (Transient Snapping)**：引入微观波形对齐技术，将切点自动吸附到最近的鼓点（Onset）和过零点（Zero-Crossing），消除爆音和节奏不稳。
    * **微积木化 (Micro-Modularization)**：将长 Intro/Outro 拆解为更小的循环单元，允许算法根据时长灵活删减重复部分，同时通过 **"End-Locking"** 策略强制保留原曲真实的淡出尾音（Fade Out）。
    * **可视化 v1**：引入了基于色块的时间轴视图。

---

## 📅 第三阶段：语义分析与“虫洞”发现 (Semantic Analysis)
**目标**：对标 Audjust，从“切块拼接”转向基于“自相似矩阵”的**无缝循环点发现**。

* **核心迭代**：
    * **Beat-Synchronous Shingling**：算法升级，不再比对单帧相似度，而是比对“4拍序列”的特征堆叠，大幅提升了 Loop 识别的准确率。
    * **动态阈值扫描**：实现了自适应搜索，确保即使在重复性不高的歌曲中也能挖掘出潜在的 Loop。
    * **Loop 预览系统**：
        * 前端展示检测到的所有 Loop 列表。
        * 支持生成 A->B->A 的无缝循环预览音频，让用户“所见即所听”。
    * **视觉升级**：
        * 波形图高亮显示 Loop 区域（亮蓝色前景 + 深灰色背景）。
        * 实现了 Audjust 风格的深色 UI。

---

## 📅 第四阶段：智能重组策略 (Smart Remixing)
**目标**：实现真正的“任意时长适配”，同时处理**延长**（Extension）和**缩短**（Shortening）两种场景。

* **核心迭代**：
    * **多 Loop 线性规划**：
        * **延长模式**：筛选出多个互不重叠的高质量 Loop（如 Verse Loop 和 Chorus Loop），根据目标时长按权重分配循环次数，保持原曲的线性叙事结构（Intro -> Verse xN -> Chorus xM -> Outro）。
    * **全局最优缝合 (Global Optimal Stitch)**：
        * **缩短模式**：当目标时长 < 原曲时长时，不再依赖 Loop，而是通过全网格搜索寻找最佳的“跳跃点”（Cut Point），直接缝合 Head 和 Tail，并利用加权评分机制在“时长精准度”和“听感相似度”之间取得平衡。
    * **可视化 v2**：
        * 双波形视图：上方展示原曲 Loop 位置，下方展示生成的 Remix 结构。
        * 精确标注：在波形图上标记具体的跳转点（Jump Markers）和精确到 0.1s 的时间戳。

---

## 📅 第五阶段：交互体验与交付 (UX & Delivery)
**目标**：优化用户操作流程，提供专业的数据交付能力。

* **核心迭代**：
    * **分析报告导出**：支持生成并下载详细的 JSON 数据文档和用户可读报告，包含所有 Loop 的起止时间、类型和置信度。
    * **交互优化**：
        * **分页功能**：为 Loop 列表添加分页和跳转功能，支持查看大量结果。
        * **布局调整**：通过 CSS Hack 优化侧边栏上传组件布局（文件列表在上传按钮上方），调整按钮尺寸和对齐方式。
        * **实时渲染**：优化了状态管理，确保点击“Generate”后立即在后台渲染音频用于绘图，避免操作延迟。

---

## 🚀 当前产品状态
目前，LoopHunter 已具备以下核心能力：
1.  **精准分析**：能够识别歌曲中的节拍、结构和高质量循环点。
2.  **双向重组**：既能通过循环 Loop 无缝延长音乐，也能通过智能剪辑缩短音乐。
3.  **专业可视化**：提供波形级的结构映射和跳转点标记。
4.  **数据化交付**：提供完整的分析数据文档。